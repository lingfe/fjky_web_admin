<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>修改信息</title>
    <!-- 引入css资源 -->
    <link rel="stylesheet" href="../../../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../../../../js/lay-module/step-lay/step.css" media="all">
</head>

<body>
    <!-- 分布表单-start -->
    <div class="layui-fluid">
        <div class="layui-card" style="height: 700px;">
            <div class="layui-card-body" style="padding-top: 20px;">
                <div class="layui-carousel" id="stepForm" lay-filter="stepForm" style="margin: 0 auto;height: auto;">
                    <div carousel-item style="overflow:initial">

                        <!-- 基本信息 -->
                        <div>
                            <form class="layui-form" style="margin: 0 auto;max-width: 800px;padding-top: 20px;">
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label">姓&#12288;&#12288;名：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="b_full_name"
                                            placeholder="请输入姓名" style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label">身份证号：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="b_id_card"
                                            lay-verify="identity" placeholder="请输入身份证号" style="width: 240px;">
                                    </div>
                                </div>

                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label">生&#12288;&#12288;日：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" id="birthday" name="birthday" value="2020-09-20"
                                            placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input"
                                            style="width:240px">
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">性&#12288;别：</label>
                                    <div class="layui-input-block" id="gender">
                                        <input type="radio" name="gender" lay-verify="required" lay-reqtext="请选择性别"
                                            value="男" title="男" checked="">
                                        <input type="radio" name="gender" lay-verify="required" lay-reqtext="请选择性别"
                                            value="女" title="女">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label">年&#12288;&#12288;龄：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="b_age" lay-verify="number"
                                            placeholder="请输入年龄" style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline">
                                    <label class="layui-form-label">民&#12288;族：</label>
                                    <div class="layui-input-inline">
                                        <select id="nation" name="nation" lay-verify="required" lay-reqtext="请选择民族"
                                            class="select_wd120">
                                            <option value="汉族">汉族</option>
                                            <option value="蒙古族">蒙古族</option>
                                            <option value="回族">回族</option>
                                            <option value="藏族">藏族</option>
                                            <option value="维吾尔族">维吾尔族</option>
                                            <option value="苗族">苗族</option>
                                            <option value="彝族">彝族</option>
                                            <option value="壮族">壮族</option>
                                            <option value="布依族">布依族</option>
                                            <option value="朝鲜族">朝鲜族</option>
                                            <option value="满族">满族</option>
                                            <option value="侗族">侗族</option>
                                            <option value="瑶族">瑶族</option>
                                            <option value="白族">白族</option>
                                            <option value="土家族">土家族</option>
                                            <option value="哈尼族">哈尼族</option>
                                            <option value="哈萨克族">哈萨克族</option>
                                            <option value="傣族">傣族</option>
                                            <option value="黎族">黎族</option>
                                            <option value="傈僳族">傈僳族</option>
                                            <option value="佤族">佤族</option>
                                            <option value="畲族">畲族</option>
                                            <option value="高山族">高山族</option>
                                            <option value="拉祜族">拉祜族</option>
                                            <option value="水族">水族</option>
                                            <option value="东乡族">东乡族</option>
                                            <option value="纳西族">纳西族</option>
                                            <option value="景颇族">景颇族</option>
                                            <option value="柯尔克孜族">柯尔克孜族</option>
                                            <option value="土族">土族</option>
                                            <option value="达斡尔族">达斡尔族</option>
                                            <option value="仫佬族">仫佬族</option>
                                            <option value="羌族">羌族</option>
                                            <option value="布朗族">布朗族</option>
                                            <option value="撒拉族">撒拉族</option>
                                            <option value="毛南族">毛南族</option>
                                            <option value="仡佬族">仡佬族</option>
                                            <option value="锡伯族">锡伯族</option>
                                            <option value="阿昌族">阿昌族</option>
                                            <option value="普米族">普米族</option>
                                            <option value="塔吉克族">塔吉克族</option>
                                            <option value="怒族">怒族</option>
                                            <option value="乌孜别克族">乌孜别克族</option>
                                            <option value="俄罗斯族">俄罗斯族</option>
                                            <option value="鄂温克族">鄂温克族</option>
                                            <option value="德昂族">德昂族</option>
                                            <option value="保安族">保安族</option>
                                            <option value="裕固族">裕固族</option>
                                            <option value="京族">京族</option>
                                            <option value="塔塔尔族">塔塔尔族</option>
                                            <option value="独龙族">独龙族</option>
                                            <option value="鄂伦春族">鄂伦春族</option>
                                            <option value="赫哲族">赫哲族</option>
                                            <option value="门巴族">门巴族</option>
                                            <option value="珞巴族">珞巴族</option>
                                            <option value="基诺族">基诺族</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label">联系电话：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="b_phone"
                                            lay-verify="required|phone" placeholder="请输入联系电话" value=""
                                            style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label">户籍地址：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="permanent_address"
                                            placeholder="请输入户籍地址" value="" style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label
                                        class="layui-input-label">爱&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;好：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="hobby" placeholder="请输入爱好"
                                            value="" style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label">饮食禁忌：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="diet_taboo"
                                            placeholder="请输入饮食禁忌" style="width: 240px;">
                                    </div>
                                </div>
                                <input id="jbid" type="text" style="display: none" readonly="" value=''>

                                <div class="layui-form-item" style="margin: 80px auto;padding: 5px auto;">
                                    <div class="layui-input-block" style="margin-left: 290px;">
                                        <button class="layui-btn" lay-submit lay-filter="save">
                                            &emsp;保存&emsp;
                                        </button>
                                        <button class="layui-btn layui-btn-primary" lay-submit lay-filter="formStep">
                                            下一步
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <!-- 家属信息 -->
                        <div>
                            <form class="layui-form" style="margin: 0 auto;max-width: 750px;padding-top: 20px;">
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label">家属姓名：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="family_name"
                                            placeholder="请输入姓名" value="" style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label required">联系电话：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="family_phone"
                                            lay-verify="required|phone" placeholder="请输入联系电话" style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label required">身份证号：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="family_id_card"
                                            lay-verify="identity" placeholder="请输入身份证号" style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label required">联系地址：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="family_contact_address"
                                            placeholder="请输入联系地址" style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;">
                                    <label class="layui-form-label required" style="width:100px">与客户关系：</label>
                                    <div class="layui-input-inline">
                                        <select id="and_relation" name="and_relation" lay-verify="required"
                                            lay-reqtext="请选择民族" class="select_wd120">
                                            <option value="祖孙">祖孙</option>
                                            <option value="父子">父子</option>
                                            <option value="母子">母子</option>
                                            <option value="母女">母女</option>
                                            <option value="姐妹">姐妹</option>
                                            <option value="兄妹">兄妹</option>
                                            <option value="姐弟">姐弟</option>
                                            <option value="叔侄">叔侄</option>
                                            <option value="公孙">公孙</option>
                                            <option value="孙女">孙女</option>
                                            <option value="孙子">孙子</option>
                                            <option value="兄弟">兄弟</option>
                                            <option value="侄女">侄女</option>
                                            <option value="外孙女">外孙女</option>
                                            <option value="妻子">妻子</option>
                                            <option value="姊妹">姊妹</option>
                                            <option value="配偶">配偶</option>
                                            <option value="女婿">女婿</option>
                                            <option value="儿媳">儿媳</option>
                                            <option value="婆媳">婆媳</option>
                                            <option value="夫妻">夫妻</option>
                                            <option value="户主">户主</option>
                                            <option value="子女">子女</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="layui-inline" style="margin-top:10px;margin-left:40px;width:300px">
                                    <label class="layui-form-label required" style="width:100px">是否监护人：</label>
                                    <div class="layui-input-block" id="is_guardian">
                                        <input type="radio" name="is_guardian" lay-verify="required"
                                            lay-reqtext="请选择是否监护人" value="是" title="是" checked="">
                                        <input type="radio" name="is_guardian" lay-verify="required"
                                            lay-reqtext="请选择是否监护人" value="否" title="否">
                                    </div>
                                </div>
                                <input id="family_id" type="text" style="display: none" readonly="" value=''>
                                <div class="layui-form-item" style="margin-top: 20px;margin-left: 12%;">
                                    <div class="layui-input-block">
                                        <button type="button" class="layui-btn layui-btn-primary pre">上一步</button>
                                        <button class="layui-btn" lay-submit lay-filter="save2">
                                            &emsp;保存&emsp;
                                        </button>
                                        <button class="layui-btn layui-btn-primary" lay-submit lay-filter="formStep2">
                                            下一步
                                        </button>
                                    </div>
                                </div>
                            </form>

                            <!-- 家属列表 -->
                            <div style="width: 80%;margin: auto;">
                                <script type="text/html" id="toolbarDemo">
                                    <div class="layui-btn-container">
                                        <!-- 表头操作 -->
                                        <button class="layui-btn layui-btn-normal layui-btn-sm data-add-btn" lay-event="add"> 新增 </button>
                                            <span class="layui-btn layui-btn-primary pre" style="margin-left:42%;border:0">客户家属列表</span>
                                    </div>
                                </script>
                                <table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>
                                <input id="family_yw_id" type="text" style="display: none;" readonly="" value=''>
                                <!-- 列表操作 -->
                                <script type="text/html" id="currentTableBar">
                                    <a class="layui-btn layui-btn-xs layui-btn-danger data-count-delete"
                                    lay-event="delete"><i class="layui-icon layui-icon-delete"></i>删除</a>
                                </script>
                            </div>
                        </div>

                        <!-- 健康信息 -->
                        <div>
                            <form class="layui-form" id="hea_info"
                                style="margin: 0 auto;max-width: 800px;padding-top: 30px;">
                                <div class="layui-inline" style="margin-top:10px;margin-left:20px">
                                    <label class="layui-form-label required">自理情况：</label>
                                    <div class="layui-input-inline">
                                        <select id="hea_zili_situation" name="hea_zili_situation" lay-verify="required"
                                            lay-reqtext="请选择自理情况" class="select_wd120">
                                            <option value="介助">介助</option>
                                            <option value="介护">介护</option>
                                            <option value="失能老人">失能老人</option>
                                            <option value="半失能老人">半失能老人</option>
                                            <option value="其他">其他</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:20px">
                                    <label class="layui-form-label required">视力情况：</label>
                                    <div class="layui-input-inline">
                                        <select id="hea_vision" name="hea_vision" lay-verify="required"
                                            lay-reqtext="请选择视力情况" class="select_wd120">
                                            <option value="正常">正常</option>
                                            <option value="有损">有损</option>
                                            <option value="失明">失明</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:20px">
                                    <label class="layui-form-label required">听力情况：</label>
                                    <div class="layui-input-inline">
                                        <select id="hea_hearing" name="hea_hearing" lay-verify="required"
                                            lay-reqtext="请选择听力情况" class="select_wd120">
                                            <option value="正常">正常</option>
                                            <option value="轻度听力障碍">轻度听力障碍</option>
                                            <option value="重度听力障碍">重度听力障碍</option>
                                            <option value="失聪">失聪</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:45px">
                                    <label class="layui-input-label">主治医院：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="hea_zhuzhi_hospital"
                                            placeholder="请输入主治医院" value="" style="width: 200px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:45px">
                                    <label class="layui-input-label">主治医师：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="hea_zhuzhi_doctor"
                                            placeholder="请输入主治医师" value="" style="width: 200px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:45px">
                                    <label class="layui-input-label">医院电话：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="hea_hospital_phone"
                                            oninput="value=value.replace(/[^\d]/g,'')" placeholder="请输入医院电话" value=""
                                            style="width: 200px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:45px">
                                    <label class="layui-input-label">过敏药物：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="hea_allergy_medicine"
                                            placeholder="请输入过敏药物" value="" style="width: 200px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:45px">
                                    <label class="layui-input-label">病史情况：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="hea_medical_history"
                                            placeholder="请输入病史情况" value="" style="width: 200px;">
                                    </div>
                                </div>
                                <div class="layui-form-item" style="margin-top:10px;margin-left:20px">
                                    <label class="layui-form-label">主要疾病：</label>
                                    <div class="layui-input-block" id="hea_zhuyao_disease">
                                        <input type="checkbox" name="hea_zhuyao_disease" value="高血糖" title="高血糖">
                                        <input type="checkbox" name="hea_zhuyao_disease" value="高血压" title="高血压">
                                        <input type="checkbox" name="hea_zhuyao_disease" value="心脏病" title="心脏病">
                                        <input type="checkbox" name="hea_zhuyao_disease" value="脑血栓" title="脑血栓">
                                        <input type="checkbox" name="hea_zhuyao_disease" value="冠心病" title="冠心病">
                                        <input type="checkbox" name="hea_zhuyao_disease" value="关节炎" title="关节炎">
                                        <input type="checkbox" name="hea_zhuyao_disease" value="风湿" title="风湿">
                                        <input type="checkbox" name="hea_zhuyao_disease" value="其他" title="其他">
                                    </div>
                                </div>
                                <input id="hea_id" type="text" style="display: none" readonly="" value=''>
                                <div class="layui-form-item" style="margin-top:40px;margin-left:13%">
                                    <div class="layui-input-block">
                                        <button type="button" class="layui-btn layui-btn-primary pre">上一步</button>
                                        <button class="layui-btn" lay-submit lay-filter="save3">
                                            &emsp;保存&emsp;
                                        </button>
                                        <button class="layui-btn layui-btn-primary" lay-submit lay-filter="formStep3">
                                            下一步
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>

                        <!-- 床位信息 -->
                        <div>
                            <form class="layui-form" style="margin: 0 auto;max-width: 700px;padding-top: 40px;">
                                <div class="layui-inline" style="margin-top:10px;margin-left:10px">
                                    <label class="layui-form-label required">床位类型：</label>
                                    <div class="layui-input-block">
                                        <input type="radio" name="bed_type" lay-verify="required" lay-reqtext="请选择床位类型"
                                            value="高级" title="高级" checked="">
                                        <input type="radio" name="bed_type" lay-verify="required" lay-reqtext="请选择床位类型"
                                            value="中级" title="中级">
                                        <input type="radio" name="bed_type" lay-verify="required" lay-reqtext="请选择床位类型"
                                            value="一般" title="一般">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:10px">
                                    <label class="layui-form-label required">是否包房：</label>
                                    <div class="layui-input-block">
                                        <input type="radio" name="bed_is_baofang" lay-verify="required"
                                            lay-reqtext="请选择是否包房" value="是" title="是" checked="">
                                        <input type="radio" name="bed_is_baofang" lay-verify="required"
                                            lay-reqtext="请选择是否包房" value="否" title="否">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label
                                        class="layui-input-label required">费&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;用：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="bed_cost"
                                            oninput="value=value.replace(/[^\d]/g,'')" placeholder="请输入费用" value=""
                                            style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label
                                        class="layui-input-label required">床&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;位：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="bed" lay-submit
                                            lay-filter="bedbutton" style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label class="layui-input-label ">床位描述：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="bed_describe"
                                            placeholder="请输入床位描述" value="" style="width: 240px;">
                                    </div>
                                </div>
                                <div class="layui-inline" style="margin-top:10px;margin-left:40px">
                                    <label
                                        class="layui-input-label ">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注：</label>
                                    <div class="layui-input-inline">
                                        <input type="text" class="layui-input dateIcon" id="bed_remark"
                                            placeholder="请输入备注" value="" style="width: 240px;">
                                    </div>
                                </div>
                                <!-- 原始id -->
                                <input id="bed_id" type="text" style="display: none" readonly="" value=''>
                                <!-- 床位id -->
                                <input id="bedId" type="text" style="display: none" readonly="" value=''>
                                <div class="layui-form-item" style="margin-top:40px;margin-left: 10%;">
                                    <div class="layui-input-block">
                                        <button type="button" class="layui-btn layui-btn-primary pre">上一步</button>
                                        <button class="layui-btn" lay-submit lay-filter="save4">
                                            &emsp;保存&emsp;
                                        </button>
                                        <button class="layui-btn layui-btn-primary" lay-submit lay-filter="formStep4">
                                            下一步
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <!-- 结尾 -->
                        <div style="text-align: center;margin-top: 90px;">
                            <i class="layui-icon layui-circle"
                                style="color: white;font-size:30px;font-weight:bold;background: #52C41A;padding: 20px;line-height: 80px;">&#xe605;</i>
                            <div style="font-size: 24px;color: #333;font-weight: 500;margin-top: 30px;">
                                填写完毕！
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- 分布表单-end -->

    <!-- 引入js资源 -->
    <script src="../../../../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="../../../../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
    <script src="../../../../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
    <script src="../../../bcxt/login/login.js"></script>
    <script>
        // 加载组件资源
        layui.use(['form', 'step', "tree", 'treetable', 'laydate', 'table', 'layer'], function () {
            var $ = layui.$;
            form = layui.form,
                layer = layui.layer,
                table = layui.table,    //表格格式
                laydate = layui.laydate;//日期格式
            var tree = layui.tree;
            var treetable = layui.treetable;
            step = layui.step;  //分布表单
            var token = Storage.get("token");
            let qiId = $("#jbid").val();//父级id


            /* 监听床位信息*/
            form.on('submit(bedbutton)', function (data) {
                var index = layer.open({
                    title: '床位信息',
                    type: 2,
                    shade: 0.2,
                    maxmin: true,
                    shadeClose: true,
                    area: ['400px', '350px'],
                    content: '../bedselection/bedInfo.html',
                    success: function (layero, index) {//弹出层打开后的回调函数
                        // layer.full(index);
                        var iframe = window['layui-layer-iframe' + index];

                    }
                });

            });

            // 根据id获取相关信息
            function getdata() {
                $.ajax({
                    url: '/sys_fkcy/essential_information/getWhereId?id=' + $("#jbid").val(),
                    headers: { //通过 request 头传递
                        token: token
                    },
                    type: 'post',
                    dataType: 'json',
                    success: function (res) {
                        var basicinfo = res.data.essential_info;
                        var familyinfo = res.data.family_info[0];
                        var heainfo = res.data.healthy_info[0];
                        var bedinfo = res.data.bed_info[0];

                        //基本信息
                        $("#b_full_name").val(basicinfo.full_name);
                        $("#b_id_card").val(basicinfo.id_card);
                        $("#b_age").val(basicinfo.age);
                        $("#b_phone").val(basicinfo.phone);
                        $("#permanent_address").val(basicinfo.permanent_address);
                        $("#hobby").val(basicinfo.hobby);
                        $("#diet_taboo").val(basicinfo.diet_taboo);
                        //家属信息
                        $("#family_id").val(familyinfo.id);
                        $("#f_yw_id").val(familyinfo.yw_id);
                        $("#family_name").val(familyinfo.full_name);
                        $("#family_phone").val(familyinfo.phone);
                        $("#family_id_card").val(familyinfo.id_card);
                        $("#family_contact_address").val(familyinfo.contact_address);
                        $("option[value='" + familyinfo.and_relation + "']").attr("selected", true);
                        $("input[name=is_guardian][value='" + familyinfo.is_guardian + "']").attr("checked", true);
                        //健康信息
                        $("#hea_id").val(heainfo.id);
                        $("#hea_zhuzhi_doctor").val(heainfo.hea_zhuzhi_doctor);
                        $("#hea_zhuzhi_hospital").val(heainfo.hea_zhuzhi_hospital);
                        $("#hea_hospital_phone").val(heainfo.hea_hospital_phone);
                        $("#hea_allergy_medicine").val(heainfo.hea_allergy_medicine);
                        $("#hea_medical_history").val(heainfo.hea_medical_history);
                        var strs = new Array(); //定义一数组
                        var resu = heainfo.hea_zhuyao_disease.split(","); //字符分割
                        for (var i = 0; i < resu.length; i++) {
                            //在一个div id为check的框里循环添加多选框
                            //设置多选框属性
                            $("input[name=hea_zhuyao_disease][value='" + resu[i] + "']").attr("checked", true);
                        }
                        // 更新表单
                        form.render('checkbox');
                        //下拉框 自理情况、视力情况、听力情况赋值
                        $("option[value='" + heainfo.hea_zili_situation + "']").attr("selected", true);
                        $("option[value='" + heainfo.hea_vision + "']").attr("selected", true);
                        $("option[value='" + heainfo.hea_hearing + "']").attr("selected", true);

                        //床位选择
                        $("#bed_id").val(bedinfo.id);
                        $("#bed_cost").val(bedinfo.bed_cost);
                        $("#bed").val(bedinfo.bed);
                        $("#bed_describe").val(bedinfo.bed_describe);
                        $("#bed_remark").val(bedinfo.bed_remark);
                        $.id = familyinfo.yw_id;
                        $("input[name=bed_type][value='" + bedinfo.bed_type + "']").attr("checked", true);
                        $("input[name=bed_is_baofang][value='" + bedinfo.bed_is_baofang + "']").attr("checked", true);
                        //重新加载页面
                        layui.form.render();
                    }
                });
            }

            // 分布表单上一步，下一步
            form.on('submit(formStep)', function (data) {
                step.next('#stepForm');
                return false;
            });
            form.on('submit(formStep2)', function (data) {
                step.next('#stepForm');
                return false;
            });
            form.on('submit(formStep3)', function (data) {
                step.next('#stepForm');
                return false;
            });
            form.on('submit(formStep4)', function (data) {
                location.href='../payment/payment.html';
                // step.next('#stepForm');
                return false;
            });
            $('.pre').click(function () {
                step.pre('#stepForm');
            });

            //日期-生日
            laydate.render({
                elem: '#birthday'
            });

            // 顶部步骤标题
            step.render({
                elem: '#stepForm',
                filter: 'stepForm',
                width: '100%', //设置容器宽度
                stepWidth: '750px',
                height: '450px',
                stepItems: [{
                    title: '填写基本信息'
                }, {
                    title: '填写家属信息'
                }, {
                    title: '填写健康信息'
                }, {
                    title: '选择床位信息'
                },
                {
                    title: '入院缴费'
                },
                {
                    title: '完成'
                }]
            });

            //家属信息数据表
            table.render({
                elem: '#currentTableId',
                url: '/sys_fkcy/family_information/getWhereYwId.action?yw_id=' + qiId, //数据接口
                toolbar: '#toolbarDemo',
                cellMinWidth: 80,
                headers: header,
                defaultToolbar: ['filter', 'exports', 'print', {
                    title: '提示',
                    layEvent: 'LAYTABLE_TIPS',
                    icon: 'layui-icon-tips'
                }],
                cols: [[
                    { field: 'yw_id', width: 80, title: '业务id', align: "center" },
                    { field: 'full_name', width: 100, title: '姓名', align: "center" },
                    { field: 'phone', width: 120, title: '联系电话', align: "center" },
                    { field: 'id_card', width: 180, title: '身份证号', align: "center" },
                    { field: 'contact_address', width: 200, title: '联系地址', align: "center" },
                    { field: 'and_relation', width: 80, title: '关系', align: "center" },
                    { field: 'is_guardian', width: 100, title: '是否监护人', align: "center" },
                    { title: '操作', minWidth: 80, toolbar: '#currentTableBar', align: "center", fixed: "right" }
                ]],
                response: {
                    statusName: 'code', //规定返回的状态码字段为code
                    statusCode: 200 //规定成功的状态码味200
                },
                parseData: function (res) {
                    return {
                        "count": res.count + 1,
                        "code": res.state, //解析接口状态
                        "msg": res.msg, //解析提示文本
                        "data": res.data //解析数据列表
                    }
                },
                limits: [10, 15, 20, 25, 50, 100],
                limit: 15,
                size: 'lg',
                //even:true,//隔行背景
                page: false,
                skin: 'rows'
            });



            //toolbar监听事件
            table.on('toolbar(currentTableFilter)', function (obj) {
                var data = obj.data;
                if (obj.event === 'add') {  // 监听添加操作
                    var index = layer.open({
                        title: '添加家属',
                        type: 2,
                        shade: 0.2,
                        maxmin: true,
                        shadeClose: true,
                        area: ['850px', '100%'],
                        content: './basicInfo_add.html',
                        success: function (layero, index) {//弹出层打开后的回调函数
                            // layer.full(index);
                            var iframe = window['layui-layer-iframe' + index]
                            // 向子页面的全局函数child传参
                            iframe.child(qiId);
                            layer.iframeAuto(index);
                            layer.style(index, {
                                // 重新居中的样式
                                top: (layui.$(window).height() - layui.$(layero).height()) / 2
                            })
                        }
                    });
                }
            });

            //监听行单击事件（双击事件为：rowDouble）
            table.on('row(currentTableFilter)', function (obj) {
                var data = obj.data;
                $("#family_id").val(data.id);
                $("#f_yw_id").val(data.yw_id);
                $("#family_name").val(data.full_name);
                $("#family_phone").val(data.phone);
                $("#family_id_card").val(data.id_card);
                $("#family_contact_address").val(data.contact_address);
                //获取当前窗口的name
                var index = parent.layer.getFrameIndex(window.name);
                if (data.is_guardian == '是') {
                    body.find("input[name=is_guardian][value='是']").attr("checked", true);
                } else {
                    body.find("input[name=is_guardian][value='否']").attr("checked", true);
                }
                // 更新表单
                form.render();
                //标注选中样式
                obj.tr.addClass('layui-table-click').siblings().removeClass('layui-table-click');
            });

            //监听操作事件
            table.on('tool(currentTableFilter)', function (obj) {
                var data = obj.data;
                if (obj.event === 'delete') {
                    layer.confirm('确认删除吗？', { title: "提示", icon: 3 }, function (index) {
                        obj.del();
                        $.ajax({
                            url: '/sys_fkcy/family_information/deleteWhereId.action?id=' + data.id,
                            type: 'post',
                            headers: header,
                            success: function (data) {
                                if (data.state != 200) {
                                    layer.msg(data.msg, { icon: 5 });//失败的表情
                                    return;
                                } else {
                                    layer.msg(data.msg, {
                                        icon: 6,//成功的表情
                                        time: 1000 //1秒关闭（如果不配置，默认是3秒）
                                    }, function () {
                                        obj.del();
                                    });
                                }
                            },
                        });
                    });
                }
            });

            /*
            监听基本信息
            */
            form.on('submit(save)', function (data) {
                $.ajax({
                    url: '/sys_fkcy/essential_information/updateWhereId.action',
                    context: document.body,
                    headers: { //通过 request 头传递
                        token: token
                    },
                    type: "POST",
                    // dataType: "data",
                    data: {
                        "id": $("#jbid").val(),
                        "full_name": $("#b_full_name").val(),
                        "id_card": $("#b_id_card").val(),
                        "birthday": $("#birthday").val(),
                        "gender": $("input[name='gender']:checked").val(),
                        "age": $("#b_age").val(),
                        "nation": $("#nation").val(),
                        "phone": $("#b_phone").val(),
                        "permanent_address": $("#permanent_address").val(),
                        "hobby": $("#hobby").val(),
                        "diet_taboo": $("#diet_taboo").val()
                    }, xhrFields: {
                        withCredentials: true
                    },
                    success: function (data) {
                        if (data.state == 200) {
                            layer.msg(data.msg, {
                                icon: 6,//成功的表情
                                time: 1000, //1秒关闭（如果不配置，默认是3秒）
                            });
                            $.yw_id = data.data.id;
                        }
                    }
                });
                // step.next('#stepForm');
                return false;
            });

            /*
            监听家庭信息
            */
            form.on('submit(save2)', function (data) {
                $.ajax({
                    url: '/sys_fkcy/family_information/updateWhereId.action',
                    context: document.body,
                    headers: { //通过 request 头传递
                        token: token
                    },
                    type: "POST",
                    data: {
                        "id": $("#family_id").val(),
                        "full_name": $("#family_name").val(),
                        "phone": $("#family_phone").val(),
                        "id_card": $("#family_id_card").val(),
                        "contact_address": $("#family_contact_address").val(),
                        "and_relation": $("#and_relation").val(),
                        "is_guardian": $("input[name='is_guardian']:checked").val()
                    }, xhrFields: {
                        withCredentials: true
                    },
                    success: function (data) {
                        if (data.state == 200) {
                            layer.msg(data.msg, {
                                icon: 6,//成功的表情
                                time: 1000 //1秒关闭（如果不配置，默认是3秒）
                            });
                            //关闭并刷新
                            table.reload('currentTableId', {})
                        }
                    }
                });
                // step.next('#stepForm');
                return false;
            });

            /*
            监听健康信息
            */
            form.on('submit(save3)', function (data) {
                //定义数组，获取主要疾病选中的值
                var arr = new Array();
                $("input:checkbox[name='hea_zhuyao_disease']:checked").each(function (i) {
                    arr[i] = $(this).val();
                });
                //将数组合并成字符串
                var hea_zhuyao_disease = arr.join(",");
                //提交健康信息表单
                $.ajax({
                    url: '/sys_fkcy/healthy_info/updateWhereId.action',
                    context: document.body,
                    headers: { //通过 request 头传递
                        token: token
                    },
                    type: "POST",
                    // dataType: "data",
                    data: {
                        "id": $("#hea_id").val(),
                        "hea_zili_situation": $("#hea_zili_situation").val(),
                        "hea_vision": $("#hea_vision").val(),
                        "hea_hearing": $("#hea_hearing").val(),
                        "hea_zhuzhi_hospital": $("#hea_zhuzhi_hospital").val(),
                        "hea_zhuzhi_doctor": $("#hea_zhuzhi_doctor").val(),
                        "hea_hospital_phone": $("#hea_hospital_phone").val(),
                        "hea_allergy_medicine": $("#hea_allergy_medicine").val(),
                        "hea_medical_history": $("#hea_medical_history").val(),
                        "hea_zhuyao_disease": hea_zhuyao_disease

                    }, xhrFields: {
                        withCredentials: true
                    },
                    success: function (data) {
                        if (data.state == 200) {
                            layer.msg(data.msg, {
                                icon: 6,//成功的表情
                                time: 1000 //1秒关闭（如果不配置，默认是3秒）
                            });
                        }
                    }
                });
                // step.next('#stepForm');
                return false;
            });

            /*
             监听床位选择
             */
            form.on('submit(save4)', function (data) {
                $.ajax({
                    url: '/sys_fkcy/bed_selection/updateWhereId.action',
                    context: document.body,
                    headers: { //通过 request 头传递
                        token: token
                    },
                    type: "POST",
                    // dataType: "data",
                    data: {
                        "id": $("#bed_id").val(),
                        "bed_id": $("#bedid").val(),
                        "bed_type": $("input[name='bed_type']:checked").val(),
                        "bed_is_baofang": $("input[name='bed_is_baofang']:checked").val(),
                        "bed_cost": $("#bed_cost").val(),
                        "bed_remark": $("#bed_remark").val(),
                        "bed": $("#bed").val(),
                        "bed_describe": $("#bed_describe").val()

                    }, xhrFields: {
                        withCredentials: true
                    },
                    success: function (data) {
                        if (data.state == 200) {
                            layer.msg(data.msg, {
                                icon: 6,//成功的表情
                                time: 1000 //1秒关闭（如果不配置，默认是3秒）
                            });
                        }
                    }
                });
                // step.next('#stepForm');
                return false;
            });
            getdata();
        });

        // 获取父级id
        function child(data) {
            $("#jbid").val(data.id);
        }
        // 获取第二个子页面传来的值并修改
        function getDataFromSon(data) {
            $("#bed").val(data.floor_tung_name + '-' + data.floor_layer + '-' + data.room_number + '-' + data.bed_number);
            $("#bedid").val(data.id);
        }
    </script>
</body>

</html>