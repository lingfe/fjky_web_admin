<!-- 
	v1.0: 2021-2-23 重写 ---李杰
 -->
<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<title>基本信息编辑</title>
		<!-- 引入css资源 -->
		<link rel="stylesheet" href="../../../lib/layui-v2.5.5/css/layui.css">
		<link rel="stylesheet" href="../../../js/lay-module/steps/style.css">
	</head>

	<body style="padding: 20px">
		<!-- 状态id -->
		<input style="display: none" id="state_id" type="text" />
		
		<!-- 分步表单-start -->
		<div id="step_demo" class="step-body">
			<!-- 步骤名称 start -->
			<div class="step-header" style="width:80%;overflow: hidden;">
				<ul>
					<li>
						<span class="step-name">基本信息登记</span>
					</li>
					<li>
						<span class="step-name">家属信息登记</span>
					</li>
					<li>
						<span class="step-name">健康信息登记</span>
					</li>
					<li>
						<span class="step-name">护理任务设置</span>
					</li>
					<li>
						<span class="step-name">餐饮床位选择</span>
					</li>
					<li>
						<span class="step-name">入院缴费</span>
					</li>
				</ul>
			</div>
			<!-- 步骤名称 end -->

			<!-- 表单-start -->
			<div class="step-content" style="margin-top:20px;">
				<!-- 基本信息 start -->
				<div class="step-list">
					<form class="layui-form" lay-filter="essential_info"
						style="margin: 0 auto;max-width: 800px;padding-top: 20px;">
						<!-- 并列一行 start -->
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">姓名</label>
								<div class="layui-input-block">
									<input class="layui-input" type="text" name="full_name" placeholder="请输入姓名" />
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label required">身份证号</label>
								<div class="layui-input-block">
									<input class="layui-input" type="text" name="id_card" lay-verify="identity"
										placeholder="请输入身份证号" />
								</div>
							</div>
						</div>
						<!-- 并列一行 end -->

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">生日</label>
							<div class="layui-input-block">
								<input class="layui-input" type="text" id="birthday" name="birthday" value="2020-09-20"
									placeholder="yyyy-MM-dd" autocomplete="off" />
							</div>
						</div>

						<!-- 并列一行 start -->
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">性别</label>
								<div class="layui-input-block">
									<input class="layui-input" type="radio" name="gender" value="男" title="男" checked="true" />
									<input class="layui-input" type="radio" name="gender" value="女" title="女" />
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">头像</label>
								<div class="layui-input-block">
									<button type="button" class="layui-btn" id="test1">
										<i class="layui-icon layui-icon-upload"></i>上传头像
									</button>
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">
									<img id="comm_img" style="width:auto;height:50px;" />
								</label>
							</div>
						</div>
						<!-- 并列一行 end -->

						<!-- 并列一行 start -->
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">年龄</label>
								<div class="layui-input-block">
									<input class="layui-input" name="age" lay-verify="number" placeholder="请输入年龄" />
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label required">民族</label>
								<div class="layui-input-block">
									<select id="nation" name="nation" lay-verify="required" lay-reqtext="请选择民族">
										<option value="汉族">汉族</option>
										<option value="蒙古族">蒙古族</option>
										<option value="回族">回族</option>
										<option value="藏族">藏族</option>
										<option value="维吾尔族">维吾尔族</option>
										<option value="苗族">苗族</option>
										<option value="彝族">彝族</option>
										<option value="壮族">壮族</option>
										<option value="布依族">布依族</option>
										<option value="朝鲜族">朝鲜族</option>
										<option value="满族">满族</option>
										<option value="侗族">侗族</option>
										<option value="瑶族">瑶族</option>
										<option value="白族">白族</option>
										<option value="土家族">土家族</option>
										<option value="哈尼族">哈尼族</option>
										<option value="哈萨克族">哈萨克族</option>
										<option value="傣族">傣族</option>
										<option value="黎族">黎族</option>
										<option value="傈僳族">傈僳族</option>
										<option value="佤族">佤族</option>
										<option value="畲族">畲族</option>
										<option value="高山族">高山族</option>
										<option value="拉祜族">拉祜族</option>
										<option value="水族">水族</option>
										<option value="东乡族">东乡族</option>
										<option value="纳西族">纳西族</option>
										<option value="景颇族">景颇族</option>
										<option value="柯尔克孜族">柯尔克孜族</option>
										<option value="土族">土族</option>
										<option value="达斡尔族">达斡尔族</option>
										<option value="仫佬族">仫佬族</option>
										<option value="羌族">羌族</option>
										<option value="布朗族">布朗族</option>
										<option value="撒拉族">撒拉族</option>
										<option value="毛南族">毛南族</option>
										<option value="仡佬族">仡佬族</option>
										<option value="锡伯族">锡伯族</option>
										<option value="阿昌族">阿昌族</option>
										<option value="普米族">普米族</option>
										<option value="塔吉克族">塔吉克族</option>
										<option value="怒族">怒族</option>
										<option value="乌孜别克族">乌孜别克族</option>
										<option value="俄罗斯族">俄罗斯族</option>
										<option value="鄂温克族">鄂温克族</option>
										<option value="德昂族">德昂族</option>
										<option value="保安族">保安族</option>
										<option value="裕固族">裕固族</option>
										<option value="京族">京族</option>
										<option value="塔塔尔族">塔塔尔族</option>
										<option value="独龙族">独龙族</option>
										<option value="鄂伦春族">鄂伦春族</option>
										<option value="赫哲族">赫哲族</option>
										<option value="门巴族">门巴族</option>
										<option value="珞巴族">珞巴族</option>
										<option value="基诺族">基诺族</option>
									</select>
								</div>
							</div>
						</div>
						<!-- 并列一行 end -->

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">联系电话</label>
							<div class="layui-input-block">
								<input class="layui-input" type="text" name="phone" lay-verify="required|phone"
									placeholder="请输入联系电话" />
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">户籍地址</label>
							<div class="layui-input-block">
								<input class="layui-input" type="text" name="permanent_address" placeholder="请输入户籍地址" />
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">爱好</label>
							<div class="layui-input-block">
								<textarea class="layui-textarea" placeholder="请输入爱好" name="hobby"></textarea>
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">饮食禁忌</label>
							<div class="layui-input-block">
								<textarea class="layui-textarea" placeholder="请输入饮食禁忌" name="diet_taboo"></textarea>
							</div>
						</div>

						<!-- 隐藏参数 -->
						<input id="ess_id" style="display: none" />
						<input name="id" style="display: none" />
						<input id="img2" name="img" style="display: none" />
						<input style="display: none" name="step" value='1' />
						<input style="display: none" name="url"  value='/sys_fkcy/essential_information/updateWhereId.action' />

						<!-- 操作 -->
						<div class="layui-form-item">
							<label class="layui-form-label"></label>
							<div class="layui-input-block">
								<div class="layui-btn" lay-submit lay-filter="*"><i
										class="layui-icon layui-icon-add-circle-fine"></i>保存</div>
								<div class="layui-btn layui-btn-primary next" value='1'>下一步<i
										class="layui-icon layui-icon-right"></i></div>
							</div>
						</div>
					</form>
				</div>
				<!-- 基本信息 end -->

				<!-- 家属信息 start -->
				<div class="step-list">
					<form class="layui-form" lay-filter="family_info"
						style="margin: 0 auto;max-width: 800px;padding-top: 20px;">
						<!-- 并列一行 start -->
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">家属姓名</label>
								<div class="layui-input-block">
									<input class="layui-input" type="text" name="full_name" placeholder="请输入姓名" />
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">身份证号</label>
								<div class="layui-input-block">
									<input class="layui-input" type="text" name="id_card" lay-verify="identity"
										placeholder="请输入身份证号" />
								</div>
							</div>
						</div>
						<!-- 并列一行 end -->

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">联系电话</label>
							<div class="layui-input-block">
								<input class="layui-input" type="text" name="phone" lay-verify="required|phone"
									placeholder="请输入联系电话" />
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">关系</label>
							<div class="layui-input-block">
								<select id="and_relation" name="and_relation" lay-verify="required" lay-reqtext="请选择关系">
									<option value="祖孙">祖孙</option>
									<option value="父子">父子</option>
									<option value="母子">母子</option>
									<option value="母女">母女</option>
									<option value="姐妹">姐妹</option>
									<option value="兄妹">兄妹</option>
									<option value="姐弟">姐弟</option>
									<option value="叔侄">叔侄</option>
									<option value="公孙">公孙</option>
									<option value="孙女">孙女</option>
									<option value="孙子">孙子</option>
									<option value="兄弟">兄弟</option>
									<option value="侄女">侄女</option>
									<option value="外孙女">外孙女</option>
									<option value="妻子">妻子</option>
									<option value="姊妹">姊妹</option>
									<option value="配偶">配偶</option>
									<option value="女婿">女婿</option>
									<option value="儿媳">儿媳</option>
									<option value="婆媳">婆媳</option>
									<option value="夫妻">夫妻</option>
									<option value="户主">户主</option>
									<option value="子女">子女</option>
								</select>
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">联系地址</label>
							<div class="layui-input-block">
								<input class="layui-input" type="text" name="contact_address" placeholder="请输入联系地址" />
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">是否监护人</label>
							<div class="layui-input-block">
								<input class="layui-input" type="radio" name="is_guardian" value="是" title="是"
									checked="true" />
								<input class="layui-input" type="radio" name="is_guardian" value="否" title="否" />
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item layui-bg-cyan">
							<label class="layui-form-label">执行操作</label>
							<div class="layui-input-block">
								<input class="layui-input" type="radio" name="is_caozuo" value="update" title="修改"
									checked="true" />
								<input class="layui-input" type="radio" name="is_caozuo" value="add" title="新增" />
							</div>
						</div>

						<!-- 隐藏参数 -->
						<input style="display: none" name="id" type="text" />
						<input style="display: none" name="step" value='2' />
						<input style="display: none" name="yw_id" type="text" />
						<input style="display: none" name="url" value='/sys_fkcy/family_information/updateWhereId.action' />

						<!-- 操作 -->
						<div class="layui-form-item">
							<label class="layui-form-label"></label>
							<div class="layui-input-block">
								<div class="layui-btn layui-btn-primary pre"><i class="layui-icon layui-icon-left"></i>上一步
								</div>
								<div class="layui-btn" lay-submit lay-filter="*"><i
										class="layui-icon layui-icon-transfer"></i>确定</div>
								<button type="reset" class="layui-btn layui-btn-primary">重置<i
										class="layui-icon layui-icon-refresh"></i></button>
								<div class="layui-btn layui-btn-primary next" value='2'>下一步<i
										class="layui-icon layui-icon-right"></i></div>
							</div>
						</div>

						<!-- 家属列表 start -->
						<div class="layui-form-item">
							<!-- table展示 -->
							<table class="layui-hide" id="currentTableId" lay-filter="currentTableFilter"></table>
						</div>
						<!-- 家属列表 end -->
					</form>
				</div>
				<!-- 家属信息 end -->

				<!-- 健康信息 start -->
				<div class="step-list">
					<form class="layui-form" lay-filter="healthy_info"
						style="margin: 0 auto;max-width: 800px;padding-top: 20px;">
						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">自理情况</label>
							<div class="layui-input-block">
								<select id="hea_zili_situation" name="hea_zili_situation" lay-verify="required"
									lay-reqtext="请选择自理情况">
									<option value="正常">正常</option>
									<option value="介助">介助</option>
									<option value="介护">介护</option>
									<option value="失能老人">失能老人</option>
									<option value="半失能老人">半失能老人</option>
									<option value="其他">其他</option>
								</select>
							</div>
						</div>

						<!-- 并列一行 start -->
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">视力情况</label>
								<div class="layui-input-block">
									<select id="hea_vision" name="hea_vision" lay-verify="required" lay-reqtext="请选择视力情况">
										<option value="正常">正常</option>
										<option value="有损">有损</option>
										<option value="失明">失明</option>
									</select>
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">听力情况</label>
								<div class="layui-input-block">
									<select id="hea_hearing" name="hea_hearing" lay-verify="required"
										lay-reqtext="请选择听力情况" />
									<option value="正常">正常</option>
									<option value="轻度听力障碍">轻度听力障碍</option>
									<option value="重度听力障碍">重度听力障碍</option>
									<option value="失聪">失聪</option>
									</select>
								</div>
							</div>
						</div>
						<!-- 并列一行 end -->

						<!-- 并列一行 start -->
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">主治医院</label>
								<div class="layui-input-block">
									<input class="layui-input" type="text" name="hea_zhuzhi_hospital"
										placeholder="请输入主治医院" />
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">主治医师</label>
								<div class="layui-input-block">
									<input class="layui-input" type="text" name="hea_zhuzhi_doctor" placeholder="请输入主治医师" />
								</div>
							</div>
						</div>
						<!-- 并列一行 end -->

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">医院电话</label>
							<div class="layui-input-block">
								<input class="layui-input" type="text" name="hea_hospital_phone"
									oninput="value=value.replace(/[^\d]/g,'')" placeholder="请输入医院电话" />
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">过敏药物</label>
							<div class="layui-input-block">
								<input class="layui-input" type="text" name="hea_allergy_medicine" placeholder="请输入过敏药物" />
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">病史情况</label>
							<div class="layui-input-block">
								<textarea class="layui-textarea" placeholder="请输入病史情况"
									name="hea_medical_history"></textarea>
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">主要疾病</label>
							<div class="layui-input-block">
								<input type="checkbox" name="hea_zhuyao_disease" value="高血糖" title="高血糖">
								<input type="checkbox" name="hea_zhuyao_disease" value="高血压" title="高血压">
								<input type="checkbox" name="hea_zhuyao_disease" value="心脏病" title="心脏病">
								<input type="checkbox" name="hea_zhuyao_disease" value="脑血栓" title="脑血栓">
								<input type="checkbox" name="hea_zhuyao_disease" value="冠心病" title="冠心病">
								<input type="checkbox" name="hea_zhuyao_disease" value="关节炎" title="关节炎">
								<input type="checkbox" name="hea_zhuyao_disease" value="风湿" title="风湿">
								<input type="checkbox" name="hea_zhuyao_disease" value="其他" title="其他">
							</div>
						</div>

						<!-- 隐藏参数 -->
						<input style="display: none" name="id" type="text" />
						<input style="display: none" name="step" value='3' />
						<input style="display: none" name="url" value='/sys_fkcy/healthy_info/updateWhereId.action' />

						<!-- 操作 -->
						<div class="layui-form-item">
							<label class="layui-form-label"></label>
							<div class="layui-input-block">
								<div class="layui-btn layui-btn-primary pre"><i class="layui-icon layui-icon-left"></i>上一步
								</div>
								<div class="layui-btn" lay-submit lay-filter="*"><i
										class="layui-icon layui-icon-add-circle-fine"></i>保存</div>
								<div class="layui-btn layui-btn-primary next" value='3'>下一步<i
										class="layui-icon layui-icon-right"></i></div>
							</div>
						</div>
					</form>
				</div>
				<!-- 健康信息 end -->

				<!-- 护理任务 start -->
				<div class="step-list"> 
					<form class="layui-form" lay-filter="nursing_info"
						style="margin: 0 auto;max-width: 800px;padding-top: 20px;">
						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">护理级别</label>
							<div class="layui-input-block">
								<input class="layui-input" id='nt_level' name="nt_level" lay-verify="required" lay-reqtext="请选择护理级别" type="text" onclick="open_chice()"
									placeholder="请选择护理级别">
							</div>
						</div>

						<!-- 单独一行(带说明) -->
						<div class="layui-form-item">
							<label class="layui-form-label">护理费用</label>
							<div class="layui-input-inline">
								<input class="layui-input" value="未选择" type="text" disabled  id='nt_level_cost' name="nt_level_cost" />
							</div>
							<div class="layui-form-mid layui-word-aux">元/月</div> 
						</div>

						<!-- 隐藏的参数 -->
						<input style="display: none" name="id" type="text" />
						<input style="display: none" name="step" value='4' />
						<input style="display: none" name="url" value='/sys_fkcy/jggl/nursing_task/updateWhereId.action' />

						<!-- 操作 -->
						<div class="layui-form-item">
							<label class="layui-form-label"></label>
							<div class="layui-input-block">
								<div class="layui-btn layui-btn-primary pre"><i class="layui-icon layui-icon-left"></i>上一步
								</div>
								<div class="layui-btn" lay-submit lay-filter="*">保存</div>
								<div class="layui-btn layui-btn-primary next" value='4'>下一步<i
										class="layui-icon layui-icon-right"></i></div>
							</div>
						</div>
					</form>
				</div>
				<!-- 护理任务 end -->

				<!-- 床位选择信息 start -->
				<div class="step-list">
					<form class="layui-form" lay-filter="bed_info"
						style="margin: 0 auto;max-width: 800px;padding-top: 20px;">
						<!-- 并列一行 start -->
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">餐饮套餐</label>
								<div class="layui-input-block">
									<input class="layui-input" id="bed_catering_package" name="bed_catering_package" lay-verify="required"
										lay-reqtext="请选择套餐" onclick="open_c()" placeholder="请选择餐饮套餐" />
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">套餐费用</label>
								<div class="layui-input-inline">
									<input class="layui-input" id='bed_cost_meal_package' name="bed_cost_meal_package" placeholder="未选择" />
								</div>
								<div class="layui-form-mid layui-word-aux">元/月</div>
							</div>
						</div>
						<!-- 并列一行 end -->  

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">套餐详情</label>
							<div class="layui-input-block">
								<textarea class="layui-textarea" placeholder="请输入套餐详情"
									name="bed_catering_package_details"></textarea>
							</div>
						</div>

						<!-- 单独一行 
						<div class="layui-form-item">
							<label class="layui-form-label">床位类型</label>
							<div class="layui-input-block">
								<input class="layui-input" type="radio" name="bed_type" value="高级" title="高级"
									checked="true" />
								<input class="layui-input" type="radio" name="bed_type" value="中级" title="中级" />
								<input class="layui-input" type="radio" name="bed_type" value="一般" title="一般" />
							</div>
						</div>-->

						<!-- 并列一行 start -->
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">选择床位</label>
								<div class="layui-input-block">
									<input class="layui-input" readonly unselectable="on" name="bed" id="bed" lay-submit
										lay-filter="bedbutton" placeholder="请选择床位" />
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">床位费用</label>
								<div class="layui-input-inline">
									<input class="layui-input" id="bed_cost" name="bed_cost" disabled=""
										oninput="value=value.replace(/[^\d]/g,'')" placeholder="请输入费用" />
								</div>
								<div class="layui-form-mid layui-word-aux">元/月</div>
							</div>
						</div>
						<!-- 并列一行 end -->

						<!-- 单独一行 
						<div class="layui-form-item">
							<label class="layui-form-label">是否包房</label>
							<div class="layui-input-block">
								<input type="radio" name="bed_is_baofang" value="是" title="是" checked="true" />
								<input type="radio" name="bed_is_baofang" value="否" title="否" />
							</div>
						</div>-->

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">床位描述</label>
							<div class="layui-input-block">
								<textarea class="layui-textarea" placeholder="请输入床位描述" name="bed_describe"></textarea>
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">备注</label>
							<div class="layui-input-block">
								<textarea class="layui-textarea" placeholder="请输入备注" name="bed_remark"></textarea>
							</div>
						</div>

						<!-- 隐藏参数 -->
						<input id="bed_id" name="bed_id" type="text" style="display: none" />
						<input style="display: none" name="id" type="text" />
						<input style="display: none" name="step" value='5' />
						<input style="display: none" name="url" value='/sys_fkcy/bed_selection/updateWhereId.action' />

						<!-- 操作 -->
						<div class="layui-form-item">
							<label class="layui-form-label"></label>
							<div class="layui-input-block">
								<div class="layui-btn layui-btn-primary pre"><i class="layui-icon layui-icon-left"></i>上一步
								</div>
								<div class="layui-btn" lay-submit lay-filter="*"><i
										class="layui-icon layui-icon-add-circle-fine"></i>保存
								</div>
								<div class="layui-btn layui-btn-primary next" value='5'>下一步<i
										class="layui-icon layui-icon-right"></i>
								</div>
							</div>
						</div>
					</form>
				</div>
				<!-- 床位选择信息 end -->

				<!-- 入院缴费 start -->
				<div class="step-list">
					<form class="layui-form" lay-filter="payment_info"
						style="margin: 0 auto;max-width: 800px;padding-top: 20px;">
						<!-- 并列一行 start -->
						<div class="layui-form-item">
							<div class="layui-inline">
								<label class="layui-form-label">押金</label>
								<div class="layui-input-block">
									<input class="layui-input" id="ap_deposit" type="text" name="ap_deposit"
										oninput="value=value.replace(/[^\d]/g,'')" placeholder="请输入押金">
								</div>
							</div>
							<div class="layui-inline">
								<label class="layui-form-label">预缴费用</label>
								<div class="layui-input-block">
									<input class="layui-input" id="ap_cost_advance" type="text" name="ap_cost_advance"
										oninput="value=value.replace(/[^\d]/g,'')" placeholder="请输入预缴费用">
								</div>
							</div>
						</div>
						<!-- 并列一行 end -->

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label required">套餐费用</label>
							<div class="layui-input-block">
								<input class="layui-input" readonly type="text" name="ap_cost_meal_package"
									oninput="value=value.replace(/[^\d]/g,'')" placeholder="请输入套餐费用" />
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">床位费用</label>
							<div class="layui-input-block">
								<input class="layui-input" readonly type="text" name="ap_cost_bed"
									oninput="value=value.replace(/[^\d]/g,'')" placeholder="请输入床位费用" />
							</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label">应缴费用</label>
							<div class="layui-input-inline">
								<input class="layui-input" id="ap_cost_payable" readonly type="text" name="ap_cost_payable"
									oninput="value=value.replace(/[^\d]/g,'')" placeholder="请输入应缴费用" />
							</div>
							<div class="layui-form-mid layui-word-aux">护理+套餐+床位</div>
						</div>

						<!-- 单独一行 -->
						<div class="layui-form-item">
							<label class="layui-form-label required">实缴费用</label>
							<div class="layui-input-inline">
								<input class="layui-input" id="ap_cost_total" readonly type="text" name="ap_cost_total"
									oninput="value=value.replace(/[^\d]/g,'')" placeholder="请输入实缴费用" />
							</div>
							<div class="layui-form-mid layui-word-aux">押金+预缴+应缴</div>
						</div>

						<!-- 隐藏参数 -->
						<input style="display: none" name="id" type="text" />
						<input style="display: none" name="step" value='6' />
						<input style="display: none" name="url" value='/sys_fkcy/admission_payment/updateWhereId.action' />

						<!-- 操作 -->
						<div class="layui-form-item">
							<label class="layui-form-label"></label>
							<div class="layui-input-block">
								<div class="layui-btn layui-btn-primary pre"><i class="layui-icon layui-icon-left"></i>上一步
								</div>
								<div class="layui-btn" lay-submit lay-filter="*"><i
										class="layui-icon layui-icon-add-circle-fine"></i>保存</div>
								<div class="layui-btn layui-btn-primary close">关闭<i
										class="layui-icon layui-icon-close-fill"></i>
								</div>
							</div>
						</div>
					</form>
				</div>
				<!-- 入院缴费 end -->
			</div>
			<!-- 表单-end -->
		</div>
		<!-- 分步表单-end -->
		
		<!-- 家庭信息表格操作 -->
		<script type="text/html" id="currentTableBar">
			<a class="layui-btn layui-btn-danger layui-btn-xs data-count-delete" lay-event="delete"><i class="layui-icon layui-icon-delete"></i>删除</a>
		</script>

		<!-- 引入js资源 -->
		<script src="../../../lib/layui-v2.5.5/layui.js" type="text/javascript"></script>
		<script src="../../../lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
		<script src="../../../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
		<script src="../../../lib/jq-module/zyupload/zyupload-1.0.0.min.js" charset="utf-8"></script>
		<script src="../../bcxt/login/login.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
			// 加载组件资源
			layui.use(['form', "tree", 'laydate', 'steps', 'table', 'layer', 'upload', 'layarea'], function () {
				//定义layui指定组件
				var $ = layui.$;
				var form = layui.form,
					layer = layui.layer,
					table = layui.table,    //表格格式
					laydate = layui.laydate,//日期格式
					tree = layui.tree;		//树组件
				var upload = layui.upload;
				var layarea = layui.layarea;
				
				//全局变量
				var data = {};
				
				//请求通行证
				var token = Storage.get("token");
				
				//父级id(基本信息id/客户id)
				let ess_id = $("#ess_id").val();
				
				// 根据id获取相关信息
				getdata();
				function getdata() {
					$.ajax({
						url: '/sys_fkcy/essential_information/getWhereId?id=' + ess_id,
						headers: { //通过 request 头传递
							token: token
						},
						type: 'post',
						dataType: 'json',
						success: function (res) {
							//验证非空
							if(res.data!=null){
								//得到数据
								var essential_info = res.data.essential_info;
								var family_info = res.data.family_info[0];
								var healthy_info = res.data.healthy_info;
								var nursing_info = res.data.nursing_info;
								var bed_info = res.data.bed_info;
								var payment_info = res.data.payment_info;
								data = res.data;

								//给表单赋值
								form.val("essential_info", essential_info);		//基本信息
								form.val("family_info", family_info);			//家庭信息
								form.val("healthy_info", healthy_info);			//健康信息
								form.val("nursing_info", nursing_info);			//护理任务
								form.val("bed_info", bed_info);					//床位选择
								form.val("payment_info", payment_info);			//入院缴费

								//验证非空
								if(healthy_info!=null){
									//处理特殊字段-健康信息-主要疾病
									var strs = new Array(); //定义一数组
									var resu = healthy_info.hea_zhuyao_disease.split(","); //字符分割
									for (var i = 0; i < resu.length; i++) {
										//在一个div id为check的框里循环添加多选框
										//设置多选框属性
										$("input[name=hea_zhuyao_disease][value='" + resu[i] + "']").attr("checked", true);
									}
								}
								
								// 更新表单
								form.render('checkbox');
							}
						}
					});
					return false;
				}

				//入院缴费-押金输入框的值改变时触发
				$("#ap_deposit").on("input", function (e) {
					ruyuanjfe_jshs();
				});

				//入院缴费-预存输入框的值改变时触发
				$("#ap_cost_advance").on("input", function (e) {
					ruyuanjfe_jshs();
				});

				//入院缴费-计算函数
				function ruyuanjfe_jshs() {
					//得到押金
					var ap_deposit = $("#ap_deposit").val();
					if (ap_deposit == "" || ap_deposit == null || ap_deposit == 'undefined') {
						ap_deposit = 0;
					}
					//得到预缴
					var ap_cost_advance = $("#ap_cost_advance").val();
					if (ap_cost_advance == "" || ap_cost_advance == null || ap_cost_advance == 'undefined') {
						ap_cost_advance = 0;
					}

					//得到应缴
					var ap_cost_payable = $("#ap_cost_payable").val();

					//计算
					var ap_cost_total = (parseInt(ap_cost_payable)
						+ parseInt(ap_cost_advance)
						+ parseInt(ap_deposit));
					//赋值实缴
					$("#ap_cost_total").val(ap_cost_total);
				}

				//分步表单操作
				var $step = $("#step_demo").step();
				var state_id = $("#state_id").val();
				//到指定步,
				if (state_id > 0) {
					$step.goStep(state_id);
				}
				
				//上一步
				$(".pre").click(function (event) {
					$step.preStep();
				});
				
				//下一步
				$(".next").click(function (event) {
					var step = event.currentTarget.attributes.value;
					//根据步骤处理
					switch (parseInt(step.value)) {
						case 1:
							//验证非空
							if (data.essential_info==undefined || data.essential_info == null ) {
								layer.msg("请先填写基本信息,再进行下一步!", { icon: 5, time: 2000 });
								return;
							}
							break;
						case 2:
							//验证非空
							if (data.family_info==undefined || data.family_info == null || data.family_info.length == 0 ) {
								layer.msg("请先填写家庭信息,再进行下一步!", { icon: 5, time: 2000 });
								return;
							}
							break;
						case 3:
							//验证非空
							if (data.healthy_info==undefined || data.healthy_info == null) {
								layer.msg("请先填写健康信息,再进行下一步!", { icon: 5, time: 2000 });
								return;
							}
							break;
						case 4:
							//验证非空
							if (data.nursing_info==undefined || data.nursing_info == null) {
								layer.msg("请设置护理任务,再进行下一步!", { icon: 5, time: 2000 });
								return;
							}
							break;
						case 5:
							//验证非空
							if (data.bed_info==undefined || data.bed_info == null) {
								layer.msg("请选择床位,再进行下一步!", { icon: 5, time: 2000 });
								return;
							}
							break;
					}
					$step.nextStep();
				});

				//图片上传
				var uploadInst = upload.render({
					elem: '#test1',
					url: '/sys_fkcy/images/imageUpload.action',
					headers: header,
					done: function (res, index, upload) {
						if (res.state == 200) {
							$("#comm_img").attr("src", res.data.imgUrl);
							$("#img2").val(res.data.imgUrl);
							layer.msg(res.msg, { icon: 6, time: 1000 });
						} else {
							layer.msg(res.msg, { icon: 5, time: 1000 });
						}
					}
				});
				
				//日期-生日
				laydate.render({
					elem: '#birthday'
				});
				
				//家属信息数据表
				table.render({
					elem: '#currentTableId',
					url: '/sys_fkcy/family_information/getWhereYwId.action', //数据接口
					headers: header,
					where: {
						yw_id: ess_id
					},
					cols: [[
						{ field: 'full_name', width: 150, title: '姓名', align: "center" },
						{ field: 'phone', width: 200, title: '联系电话', align: "center" },
						{ field: 'and_relation',width: 200, title: '关系', align: "center" },
						{ title: '操作',width: 200, toolbar: '#currentTableBar', align: "center", fixed: "right" }
					]],
					response: {
						statusName: 'code', //规定返回的状态码字段为code
						statusCode: 200 //规定成功的状态码味200
					},
					parseData: function (res) {
						return {
							"count": res.count + 1,
							"code": res.state, //解析接口状态
							"msg": res.msg, //解析提示文本
							"data": res.data //解析数据列表
						}
					},
					limits: [10, 15, 20, 25, 50, 100],
					limit: 15,
					size: 'lg',
					page: false,
					skin: 'line'
				});
				
				//监听床位信息选择
				form.on('submit(bedbutton)', function (data) {
					var index = layer.open({
						title: '床位信息',
						type: 2,
						shade: 0.2,
						maxmin: true,
						shadeClose: true,
						area: ['400px', '350px'],
						content: './bedselection/bedInfo.html',
						success: function (layero, index) { //弹出层打开后的回调函数
							// layer.full(index);
							var iframe = window['layui-layer-iframe' + index];
						}
					});
				});
				
				//监听提交
				form.on('submit(*)', function (sb) {
					//定义参数
					var field = sb.field;
					field.ess_id = $("#ess_id").val();
					field.yw_id = $("#ess_id").val();

					//验证家庭信息保存或修改操作
					if (field.is_caozuo == 'add') {
						field.url = '/sys_fkcy/family_information/save.action';
					}

					//根据步骤处理
					switch (parseInt(field.step)) {
						case 1:
							//验证非空,以及决定操作
							if (data.essential_info==undefined || data.essential_info == null ) {
								field.url = '/sys_fkcy/essential_information/save.action';
							}
							break;
						case 2:
							//验证非空
							if (data.essential_info==undefined || data.essential_info == null ) {
								layer.msg("请先填写基本信息,再进行下一步!", { icon: 5, time: 2000 });
								return;
							}else{
								//验证进行新增操作
								if (field.id == null || field.id == '') {
									field.url = '/sys_fkcy/family_information/save.action';
								}
							}
							break;
						case 3:
							//验证非空
							if (data.family_info == undefined || data.family_info == null || data.family_info.length == 0  ) {
								layer.msg("请先保存家庭信息,再进行保存健康信息!", { icon: 5, time: 2000 });
								return;
							} else {
								//验证进行新增操作
								if (field.id == null || field.id == '') {
									field.url = '/sys_fkcy/healthy_info/save.action';
								}
							}

							//获取主要疾病checkbox[name='hea_zhuyao_disease]的值
							var arr = new Array();
							$("input:checkbox[name='hea_zhuyao_disease']:checked").each(function (i) {
								arr[i] = $(this).val();
							});
							//将数组合并成字符串
							field.hea_zhuyao_disease = arr.join(",");
							break;
						case 4:
							//验证非空
							if (data.healthy_info == undefined || data.healthy_info == null) {
								layer.msg("请先保存健康,再进行设置护理任务!", { icon: 5, time: 2000 });
								return;
							} else {
								//验证进行新增操作
								if (field.id == null || field.id == '') {
									field.url = '/sys_fkcy/jggl/nursing_task/save.action';
								}
							}
							break;
						case 5:
							//验证非空
							if (data.nursing_info == undefined || data.nursing_info == null) {
								layer.msg("请设置护理任务,再进行选择床位信息!", { icon: 5, time: 2000 });
								return;
							} else {
								//验证进行新增操作
								if (field.id == null || field.id == '') {
									field.url = '/sys_fkcy/bed_selection/save.action';
								}
							}
							break;
						case 6:
							//验证非空
							if (data.bed_info == undefined || data.bed_info == null) {
								layer.msg("请选择床位信息,再进行保存入院缴费!", { icon: 5, time: 2000 });
								return;
							} else {
								//验证进行新增操作
								if (field.id == null || field.id == '') {
									field.url = '/sys_fkcy/admission_payment/save.action';
								}
							}
							break;
					}

					//请求
					$.ajax({
						url: field.url,
						context: document.body,
						headers: { token: token },
						type: "POST",
						data: field,
						xhrFields: { withCredentials: true },
						success: function (res) {
							if (res.state == 200) {
								//提示
								layer.msg(res.msg, {
									icon: 6,//成功的表情
									time: 3000, //1秒关闭（如果不配置，默认是3秒）
								});
								
								//验证步骤
								if(field.step == 1){
									$("#ess_id").val(res.data.id);
									ess_id=$("#ess_id").val();
								}

								//刷新表单
								getdata();

								//验证家庭信息保存或修改操作
								if (field.step == 2) {
									//重载table
									table.reload('currentTableId', {
										url: '/sys_fkcy/family_information/getWhereYwId.action', //数据接口
										where: {
											yw_id: ess_id
										} //设定异步数据接口的额外参数
									});
								}
							} else {
								layer.msg(res.msg, { icon: 5, time: 3000 });
							}
						}
					});
				});
			});
			
			//打开护理等级选择页
			function open_chice() {
				var index = layer.open({
					title: '选择护理级别',
					type: 2,
					shade: 0.2,
					maxmin: true,
					shadeClose: true,
					area: ['600px', '450px'],
					content: '../service_management/nursing_ma/nursingLevel.html?idn=editNursing',
					success: function (layero, index) {//弹出层打开后的回调函数 
						// layer.full(index);
						var iframe = window['layui-layer-iframe' + index];
					}
				});
			}
			
			//打开套餐选择页
			function open_c() {
				var index = layer.open({
					title: '选择套餐',
					type: 2, 
					shade: 0.2,
					maxmin: true,
					shadeClose: true,
					area: ['800px', '450px'],
					content: './basicInfo/chice/chiceCatering.html',
					success: function (layero, index) {//弹出层打开后的回调函数 
						// layer.full(index);
						var iframe = window['layui-layer-iframe' + index];
					}
				});
			}

			//父窗体调用传值
			function child(data) {
				var $ = layui.$;
				$("#ess_id").val(data.id);
				$("#comm_img").attr("src", data.img);
				$("#state_id").val(data.state);
			}
			
			//床位选择->床位文本框对应的->子页面调用设置值。
			function getDataFromSon(data) {
				var $ = layui.$;
				$("#bed").val(data.floor_tung_name + '-' + data.floor_layer + '-' + data.room_number + '-' + data.bed_number);
				$("#bed_id").val(data.id);
				$("#bed_cost").val(data.mapBedType.bt_cost_month);
			}
			
			//子窗体传值-护理级别
			function getDataFromSon_1(data) {
				var $ = layui.$;
				$("#nt_level").val(data.ging_name);
				$("#nt_level_cost").val(data.ging_cost);
			}
			
			//子窗体传值-餐饮套餐
			function getDataFromSon_2(data) {
				var $ = layui.$;
				$('#bed_catering_package').val(data.sm_name);
				$('#bed_cost_meal_package').val(data.sm_price_baoyue);
			}
		</script>
	</body>
</html>